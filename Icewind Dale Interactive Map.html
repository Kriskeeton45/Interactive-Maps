<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Map</title>
    <style>
    .map-container {
        position: relative;
        width: 1500px;
        height: 1054px;
        overflow: auto;
    }
    img {
        width: 100%;
        height: 100%;
    }
    .info-box {
        position: absolute;
        top: 20px;
        left: 20px;
        padding: 10px;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        display: none;
        z-index: 10;
    }
</style>
</head>
<body>
    <div class="map-container">
        <img src="https://drive.google.com/uc?export=view&id=1WRl4wKpXNa2h_ZNMb6NSJCLah8mId_55" usemap="#map" alt="Interactive Map">
        <div class="info-box" id="info-box"></div>
        <map name="map">
            <area shape="circle" coords="748,489,5" alt="Caer-Konig" href="#" onmouseover="showInfo(event, 'Caer-Konig')" onmouseout="hideInfo()" onclick="addNote(event, 'Caer-Konig')">            <area shape="circle" coords="113,38,10" alt="Town 2" href="#" onmouseover="showInfo(event, 'Town 2')" onmouseout="hideInfo()" onclick="addNote(event, 'Town 2')">
        </map>
    </div>
    <script>
        const SHEET_URL = 'https://script.google.com/macros/s/AKfycbwGunrJcSGvEQlD20-TZ5dzZWIG8IiXqL-Q3sUw9vCx15Js4ugS-z0FDqbTCvFCrIhM/exec';
        let areaNotes = {};

        async function fetchNotes() {
            const res = await fetch(SHEET_URL);
            areaNotes = await res.json();
        }

        async function saveNote(area, note) {
            await fetch(SHEET_URL, {
                method: 'POST',
                body: JSON.stringify({ area, note }),
                headers: { 'Content-Type': 'application/json' }
            });
            areaNotes[area] = note;
        }

        function showInfo(event, title) {
            const infoBox = document.getElementById("info-box");
            infoBox.style.display = "block";
            const note = areaNotes[title] || 'No note yet. Click to add.';
            infoBox.innerHTML = `<strong>${title}</strong><p>${note}</p>`;
            const x = event.clientX;
            const y = event.clientY;
            infoBox.style.left = `${x + 20}px`;
            infoBox.style.top = `${y + 20}px`;
        }

        function hideInfo() {
            const infoBox = document.getElementById("info-box");
            infoBox.style.display = "none";
        }

        async function addNote(event, title) {
            event.preventDefault();
            const currentNote = areaNotes[title] || '';
            const note = prompt(`Add or edit note for ${title}:`, currentNote);
            if (note !== null) {
                await saveNote(title, note);
            }
        }

        // Fetch notes on page load
        fetchNotes();
    </script>
</body>
</html>
